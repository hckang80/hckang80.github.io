<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Azul tiles counter</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter 폰트 설정 -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
      body {
        font-family: 'Inter', sans-serif;
        background-color: #0f172a; /* Slate-900 Dark Background */
      }

      /* --- 터치 최적화 및 버튼 스타일 --- */

      input[type='range'] {
        height: 12px;
        cursor: pointer;
      }

      /* Webkit (Chrome, Safari) 용 슬라이더 손잡이 스타일 */
      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 30px;
        width: 30px;
        border-radius: 50%;
        background: #3b82f6; /* Blue-500 */
        cursor: pointer;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
        margin-top: -9px;
        border: 3px solid #ffffff;
      }

      /* Mozilla (Firefox) 용 슬라이더 손잡이 스타일 */
      input[type='range']::-moz-range-thumb {
        height: 30px;
        width: 30px;
        border-radius: 50%;
        background: #3b82f6;
        cursor: pointer;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
        border: 3px solid #ffffff;
      }

      /* 모든 버튼에 대한 기본 스타일 */
      .control-button {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem; /* 버튼 아이콘 크기 */
        font-weight: 500;
        line-height: 1; /* 텍스트 중앙 정렬 */
        user-select: none; /* 드래그 방지 */
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4">
    <div id="app" class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-6 md:p-10">
      <!-- 헤더 -->
      <h1 class="text-3xl font-bold text-gray-800 mb-8">Azul tiles counter</h1>

      <!-- 슬라이더 컨테이너 -->
      <div id="sliders-container" class="space-y-6">
        <!-- 슬라이더와 버튼은 JavaScript를 통해 동적으로 생성됩니다 -->
      </div>

      <!-- 리셋 버튼 -->
      <button
        id="resetButton"
        class="mt-8 w-full px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
      >
        Reset
      </button>
    </div>

    <script>
      // 전역 상수
      const SLIDER_COUNT = 5;
      const DEFAULT_VALUE = 20;
      const MIN_VALUE = 0;
      const MAX_VALUE = 20;
      const STORAGE_KEY = 'sliderValues';
      const slidersContainer = document.getElementById('sliders-container');
      const resetButton = document.getElementById('resetButton');

      /**
       * 슬라이더 요소를 생성하고 DOM에 추가합니다.
       */
      function createSliderElement(index, value) {
        const wrapper = document.createElement('div');
        wrapper.className = 'slider-item';

        const labelText = ['blue', 'yellow', 'red', 'black', 'cyan'];

        wrapper.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <label for="slider-${index}" class="text-gray-700 font-medium text-sm md:text-base">
                      <img src="./images/${labelText[index]}.svg" alt="${labelText[index]}" width="40" height="40" />
                    </label>
                    
                    <div class="flex items-center space-x-3">
                        <!-- Plus Button -->
                        <button type="button" data-index="${index}" data-action="increment"
                                class="control-button bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-100 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 active:scale-95">
                            &plus;
                        </button>
                        
                        <!-- Value Display (Wider space for 1-2 digits) -->
                        <span id="value-${index}" class="text-xl font-bold text-blue-600 w-8 text-center">${value}</span>

                        <!-- Minus Button -->
                        <button type="button" data-index="${index}" data-action="decrement"
                                class="control-button bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-100 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 active:scale-95">
                            &minus;
                        </button>
                    </div>
                </div>
                <!-- Range Input -->
                <input type="range" id="slider-${index}" 
                       min="${MIN_VALUE}" max="${MAX_VALUE}" value="${value}" 
                       data-index="${index}" 
                       class="w-full bg-gray-200 rounded-lg appearance-none focus:outline-none">
            `;
        slidersContainer.appendChild(wrapper);

        // 슬라이더 (input) 이벤트 리스너: 슬라이드 시 값 업데이트
        const rangeInput = wrapper.querySelector(`#slider-${index}`);
        rangeInput.addEventListener('input', (event) => {
          const newValue = parseInt(event.target.value, 10);
          // 슬라이더 이동 시 값 디스플레이 및 세션 저장 업데이트
          updateSliderDisplayAndStorage(index, newValue);
        });
      }

      /**
       * 세션 스토리지에서 저장된 값을 불러옵니다.
       */
      function loadSliderValues() {
        try {
          const storedData = sessionStorage.getItem(STORAGE_KEY);
          if (storedData) {
            const values = JSON.parse(storedData);
            // 유효성 검사
            if (
              Array.isArray(values) &&
              values.length === SLIDER_COUNT &&
              values.every((v) => typeof v === 'number' && v >= MIN_VALUE && v <= MAX_VALUE)
            ) {
              return values;
            }
          }
        } catch (error) {
          console.error('Error loading or parsing sessionStorage:', error);
        }
        // 초기값 배열 반환 (모두 20)
        return Array(SLIDER_COUNT).fill(DEFAULT_VALUE);
      }

      /**
       * 현재 슬라이더의 모든 값을 세션 스토리지에 저장합니다.
       */
      function saveSliderValues() {
        const currentValues = [];
        for (let i = 0; i < SLIDER_COUNT; i++) {
          const inputElement = document.getElementById(`slider-${i}`);
          if (inputElement) {
            currentValues.push(parseInt(inputElement.value, 10));
          }
        }
        sessionStorage.setItem(STORAGE_KEY, JSON.stringify(currentValues));
      }

      /**
       * 단일 슬라이더의 값, 디스플레이를 업데이트하고 세션 스토리지에 저장합니다.
       * @param {number} index - 슬라이더 인덱스 (0-4)
       * @param {number} newValue - 설정할 새 값
       */
      function updateSliderDisplayAndStorage(index, newValue) {
        const inputElement = document.getElementById(`slider-${index}`);
        const valueDisplay = document.getElementById(`value-${index}`);

        if (inputElement && valueDisplay) {
          // DOM 값 업데이트
          inputElement.value = newValue;
          valueDisplay.textContent = newValue;

          // 세션 저장
          saveSliderValues();
        }
      }

      /**
       * +/- 버튼 클릭을 처리하는 이벤트 핸들러입니다.
       */
      function handleButtonClick(event) {
        // data-action 속성을 가진 가장 가까운 요소를 찾습니다.
        const button = event.target.closest('[data-action]');
        if (!button) return;

        const index = parseInt(button.dataset.index, 10);
        const action = button.dataset.action;
        const inputElement = document.getElementById(`slider-${index}`);

        if (!inputElement) return;

        let currentValue = parseInt(inputElement.value, 10);
        let newValue = currentValue;

        // 값 증가/감소 로직
        if (action === 'increment' && currentValue < MAX_VALUE) {
          newValue = currentValue + 1;
        } else if (action === 'decrement' && currentValue > MIN_VALUE) {
          newValue = currentValue - 1;
        }

        if (newValue !== currentValue) {
          // 슬라이더 값, 디스플레이, 세션 스토리지 업데이트
          updateSliderDisplayAndStorage(index, newValue);
        }
      }

      /**
       * 모든 슬라이더를 초기값(20)으로 설정하고 세션 스토리지에 저장합니다.
       */
      function resetSliders() {
        const initialValues = Array(SLIDER_COUNT).fill(DEFAULT_VALUE);
        initialValues.forEach((value, index) => {
          updateSliderDisplayAndStorage(index, value);
        });
      }

      /**
       * 애플리케이션 초기화 함수
       */
      function initApp() {
        // 1. DOM에 슬라이더 요소 생성
        const savedValues = loadSliderValues();

        slidersContainer.innerHTML = '';

        for (let i = 0; i < SLIDER_COUNT; i++) {
          const initialValue = savedValues[i];
          createSliderElement(i, initialValue);
        }

        // 2. 리셋 버튼 이벤트 리스너 설정
        resetButton.addEventListener('click', resetSliders);

        // 3. 버튼 이벤트 위임: 컨테이너에 단 하나의 클릭 리스너를 추가합니다.
        slidersContainer.addEventListener('click', handleButtonClick);

        // 4. 초기 로드 시 값 저장 (불러온 값이 세션에 없었다면 기본값 20으로 초기화)
        saveSliderValues();
      }

      // DOM 로드 완료 후 앱 초기화
      window.addEventListener('load', initApp);
    </script>
  </body>
</html>
